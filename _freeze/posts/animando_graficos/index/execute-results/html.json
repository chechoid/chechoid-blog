{
  "hash": "429d41329a8c07c2a6322bc85efedf1b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Animando gr치ficos con gganimate\"\nauthor: \"Checho\"\ndate: \"22/5/2024\"\ncategories: [fun, ggplot2, proyectos]\nformat: \n  html:\n    code-fold: show\n    code-summary: \"Ver c칩digo\"\n    code-copy: hover\nknitr: \n  opts_chunk: \n    warning: false\n    message: false\neditor: visual\n---\n\n\n# Dale a tu gr치fico alegr칤a Macarena\n\nHace rato que no hac칤a boludeces, as칤 que mientras pensaba un fin de semana qu칠 pod칤a hacer, Boca jugaba un nuevo partido en el cual empez칩 perdiendo y termin칩 ganando, y me d칤 cuenta que nunca hab칤a usado el paquete `gganimate` para animar una visualizaci칩n, as칤 que qu칠 mejor que usar un partido de Boca para transmitir las sensaciones del partido a trav칠s de un gr치fico animado.\n\n# gganimate\n\nPara este caso, vamos a necesitar los siguientes paquetes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)     # Leer archivos de excel\nlibrary(tidyverse)  # Procesar los datos\nlibrary(ggplot2)    # Hacer gr치ficos\nlibrary(gganimate)  # A lo que vinimos, a animar los gr치ficos\n```\n:::\n\n\n## Bocaaa, Bocaaaa, Bocaaaaaa... 游눛游눝游눛\n\nDesde que Diego Martinez, el actual DT de Boca, asumi칩 su cargo en Diciembre de 2023, una de las caracter칤sticas que tiene su gesti칩n (adem치s de jugar mejor), es que varios partidos los comenz칩 perdiendo, y termin칩 ganando. Al d칤a de hoy, (22 de mayo de 2024), **gan칩 12 partidos, de los cuales en 5 el primer gol lo hizo el rival**.\n\nAs칤 que qu칠 mejor ejemplo para graficar este caso de uso que aprovechando el vendaval de sensaciones que es mirar un partido de Boca Jrs. en la era Martinez.\n\nEn la fecha 2 del torneo local, Boca enfrent칩 como visitante a Central C칩rdoba de Santiago del Estero, que **convirtieron el primer gol a los 3' de comenzado el partido**, y luego hicieron el 2-0 en el tiempo a침adido al final del primer tiempo.\n\nApenas comenz칩 el 2춿 tiempo, Equi Fernandez hizo el 2-1, la Bestia Merentiel lo empat칩 y lo di칩 vuelta a los 52' y 80' respectivamente. Cuando el partido estaba en tiempo a침adido, Equi Fernandez puso el 2-4 final.\n\nAcomp치침enme a experimentar el vendaval de sensaciones que es vivir un partido de Boca en un gr치fico.\n\nVamos a usar el siguiente dataset:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Carga de datos\nboca <- read_excel(\"boca_vibes.xlsx\")\n\n# Explora las primeras 6 filas\nhead(boca)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 5\n  minuto central_cordoba  boca diferencia resultado  \n   <dbl>           <dbl> <dbl>      <dbl> <chr>      \n1      1               0     0          0 Empata Boca\n2      2               0     0          0 Empata Boca\n3      3               1     0         -1 Pierde Boca\n4      4               1     0         -1 Pierde Boca\n5      5               1     0         -1 Pierde Boca\n6      6               1     0         -1 Pierde Boca\n```\n\n\n:::\n:::\n\n\nEl dataset contiene un detalle de los resultados minuto a minuto, podemos observar el primer gol de Central C칩rdoba convertido por Rodrigo Uriel Atencio a los 3 minutos que deja a Boca abajo en el marcador.\n\nPara hacer el primer gr치fico necesitamos transformar un poco los datos para que los goles de `central_cordoba` y de `boca` nos queden en una misma columna.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npartido <- boca |> \n  pivot_longer(cols = c(central_cordoba, boca), \n               names_to = \"equipo\", \n               values_to = \"goles\") |> \n  mutate(equipo = str_replace(equipo, \"central_cordoba\", \"Central C칩rdoba\"),\n         equipo = str_replace(equipo, \"boca\", \"Boca Jrs.\"))\n\n# Ver c칩mo qued칩 el dataset\nhead(partido)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 5\n  minuto diferencia resultado   equipo          goles\n   <dbl>      <dbl> <chr>       <chr>           <dbl>\n1      1          0 Empata Boca Central C칩rdoba     0\n2      1          0 Empata Boca Boca Jrs.           0\n3      2          0 Empata Boca Central C칩rdoba     0\n4      2          0 Empata Boca Boca Jrs.           0\n5      3         -1 Pierde Boca Central C칩rdoba     1\n6      3         -1 Pierde Boca Boca Jrs.           0\n```\n\n\n:::\n:::\n\n\nUsemos un gr치fico de l칤neas para visualizar el partido.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n ggplot(partido) +                                           # Datos\n  geom_line(aes(x = minuto, y = goles, color = equipo),      # Tipo de gr치fico y variables\n            linewidth = 1.1) +                               # Ancho de la l칤nea\n  scale_color_manual(values = c(\"#103f79\", \"#EA0838\")) +     # Colores custom\n  theme_minimal() +                                          # Estilo del gr치fico\n  labs(title = \"Central C칩rdoba vs. Boca\",\n       x = \"Goles\", y = \"Minuto\",\n       color = \"Equipo\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/boca grafico base-1.png){width=672}\n:::\n:::\n\n\nLe podemos incorporar una l칤nea adicional para visualizar c칩mo iba el partido para Boca, en el cual podemos apreciar c칩mo arranca perdiendo, cerca del minuto '50 lo empata, y en el final lo da vuelta.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Guardamos el gr치fico en un objeto llamado 'p'\np <-  ggplot(partido) +                                           # Datos\n  geom_line(aes(x = minuto, y = goles, color = equipo),      # Tipo de gr치fico y variables\n            linewidth = 1.1) +                               # Ancho de la l칤nea\n  scale_color_manual(values = c(\"#103f79\", \"#EA0838\")) +         # Colores custom\n  theme_minimal() +                                          # Estilo del gr치fico\n  labs(title = \"Central C칩rdoba vs. Boca\",\n       x = \"Minuto\", y = \"Goles\",\n       color = \"Equipo\") +\n  geom_line(data = boca, aes(x = minuto, y = diferencia), linewidth = 1.3,\n            linetype = 2)\n\n# Veamos el gr치fico\np\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/primer grafico-1.png){width=672}\n:::\n:::\n\n\nPero venimos a ver un gr치fico animado, as칤 que demosle movimiento al gr치fico.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Animemos el gr치fico\n# transition_reveal funciona con gr치ficos de l칤neas\np + \n  transition_reveal(along = minuto) # MAGIA!!!!\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/boca primera animacion-1.gif)\n:::\n:::\n\n\nY manipulando un poco los datos podemos hacer cosas gloriosas...\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A침adir una columna para agregar un emoji en funci칩n de la diferencia y los goles\nboca <- boca |> \n  # Arranca el partido\n  mutate(estado = if_else(diferencia == 0 , \"meh\", if_else( \n  # Primer gol de Central C칩rdoba\n    diferencia < 0 & central_cordoba == 1, \"cry\",  if_else(\n  # Segundo gol de Central C칩rdoba\n      diferencia < 0 & central_cordoba == 2, \"angry\", if_else(\n  # Primer gol de Boca\n        diferencia < 0 & boca == 1, \"fear\", if_else(\n  # Segundo gol de Boca\n          diferencia == 1 & boca == 2, \"biceps\", if_else(\n  # Tercer gol de Boca y cuarto gol\n            diferencia == 1, \"smile\", \"lol\")\n          )\n        )\n      ))))\n\n\n# Mapear cada nombre de emoji a un emoji\n# Link al paquete de emoji: https://github.com/hadley/emo\nboca <- boca |> \n  mutate(emoji = map_chr(estado, emo::ji))\n\n# Veamos como quedan los datos\nhead(boca)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 칑 7\n  minuto central_cordoba  boca diferencia resultado   estado emoji       \n   <dbl>           <dbl> <dbl>      <dbl> <chr>       <chr>  <chr>       \n1      1               0     0          0 Empata Boca meh    \"\\U0001f612\"\n2      2               0     0          0 Empata Boca meh    \"\\U0001f612\"\n3      3               1     0         -1 Pierde Boca cry    \"\\U0001f622\"\n4      4               1     0         -1 Pierde Boca cry    \"\\U0001f622\"\n5      5               1     0         -1 Pierde Boca cry    \"\\U0001f622\"\n6      6               1     0         -1 Pierde Boca cry    \"\\U0001f622\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Hagamos el gr치fico final con anotaciones\np + \n  # A침adimos anotaciones en funci칩n de los goles\n  geom_text(data = boca, aes(x = 15, y = 3.5, \n                             label = paste0(\"Central C칩rdoba: \", central_cordoba,\n                                            \"\\nBoca: \", boca)),\n            size = 4,        # Tama침o de la letra\n            hjust = 0) +     # Alinea a la izquierda\n# A침adimos anotaciones usando emojis\n  geom_text(data = boca, aes(x = 15, y = 2.5, label = emoji), \n            size = 15) +\n# A침adimos un \"subt칤tulo\"\n  geom_text(data = boca, aes(x = 0, y = 4.5, label = paste0(\"Resultado: \", resultado)), hjust = 0) +\n# Animemos el gr치fico\n   transition_reveal(along = minuto)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/boca_full_experience-1.gif)\n:::\n:::\n\n\nSi quieren ver c칩mo fue el partido, pueden ver el siguiente resumen. Despu칠s me cuentan qu칠 transmite m치s emoci칩n, si mi gr치fico o el video 游븷\n\n\n{{< video https://www.youtube.com/watch?v=lVcTxBZfPNg >}}\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}