{
  "hash": "98d2a0b07806a18847da55f6cc121d16",
  "result": {
    "markdown": "---\ntitle: \"Cargar Campos de Fecha desde Excel Sin Errores\"\nauthor: \"Checho\"\ndate: \"12/09/2023\"\ncategories: [tipito, tip, an√°lisis, date, fecha]\n---\n\n\n¬øA qui√©n no le pas√≥ esto alguna vez?\n\n![](/posts/cargar_fechas_desde_excel/data/phoebe_joey.jpg){fig-align=\"center\" width=\"452\"}\n\nEsto en R muchas veces tambi√©n nos trae dolores de cabeza as√≠ que en esto post vamos a ver c√≥mo podemos solucionar esto.\n\n# El C√≥digo\n\n## Paquetes\n\nPara este ejemplo vamos a utilizar 3 paquetes, `openxlsx` que nos permite cargar y guardar archivos de Excel, `dplyr` para manipular y limpiar datos (pod√©s ver un [tutorial ac√°](https://youtu.be/-AXzusX4Cmo)). Tambi√©n vamos a usar el paquete `janitor` para limpiar los nombres de las columnas a un formato m√°s f√°cil de utilizar (elimina tildes, pasa todo a min√∫scula y reemplaza espacios por guiones, por ejemplo).\n\nEl primer paso, en caso que no los tengas a√∫n, es instalar los paquetes:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Instalar paquetes\ninstall.packages(\"openxlsx\") # Cargar y guardar archivos de Excel\ninstall.packages(\"dplyr\")    # Manipular y limpiar datos\ninstall.packages(\"janitor\")  # Entre otras cosas, facilitar manipulaci√≥n de columnas\n```\n:::\n\n\nUna vez que termina la instalaci√≥n, hay que cargarlos. No vamos a cargar el paquete `janitor` porque s√≥lo vamos a usar una funci√≥n.\n\nCargar un paquete \"deja activas\" todas las funciones del paquete, lo cual implica un consumo de memoria, muchas veces √≠nfimo, pero consumo al fin, as√≠ que en este caso mostraremos como usar una funci√≥n sin cargar todas las funciones del paquete.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar paquetes\nlibrary(openxlsx)\nlibrary(dplyr)\n```\n:::\n\n\n## Los datos\n\nEl caso que usaremos de ejemplo simula ser una base de Postulantes de una b√∫squeda que llevamos adelante para una vacante de People Analytics. Primero carguemos los datos que est√°n almacenados en una carpeta llamada `data`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar los datos en R\ndatos <- read.xlsx(\"data/Postulantes.xlsx\") %>% \n  janitor::clean_names() # Usamos solo la funci√≥n clean_names() sin cargar todo el paquete janitor\n```\n:::\n\n\nAhora veamos los datos que tenemos cargados:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ver los datos cargados\ndatos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  fecha_sourcing         busqueda   nombre apellido   telefono            mail\n1          44729 People Analytics   Sergio   Garcia 1111111111 sergio@d4hr.com\n2          44729 People Analytics  Daniela   Garcia 2222222222            <NA>\n3          44729 People Analytics    Yanel Paulette 3333333333            <NA>\n4          44729 People Analytics    Carla   Cirone 4444444444            <NA>\n5          44729 People Analytics Santiago  Lardone 5555555555            <NA>\n  empresa            puesto   github          twitter\n1    R4HR Master of Puppets chechoid @sergiogarciamor\n2    R4HR Master of Puppets     <NA>             <NA>\n3    R4HR Master of Puppets     <NA>             <NA>\n4    R4HR Master of Puppets     <NA>             <NA>\n5    R4HR Master of Puppets     <NA>             <NA>\n                                                  linkedin   fuente status\n1            https://www.linkedin.com/in/sergiogarciamora/  Twitter Activo\n2        https://www.linkedin.com/in/claudiadanielagarcia/ Linkedin Activo\n3               https://www.linkedin.com/in/yanelpaulette/ Linkedin Activo\n4       https://www.linkedin.com/in/carla-cirone-0566b095/ Linkedin Activo\n5 https://www.linkedin.com/in/santiagolardonequinodozrrhh/ Linkedin Activo\n  fecha_ultimo_contacto\n1                 44739\n2                 44739\n3                 44739\n4                 44739\n5                 44739\n```\n:::\n\n```{.r .cell-code}\n# Hagamos un zoom en los campos que contienen fechas\ndatos %>% \n  select(fecha_sourcing, fecha_ultimo_contacto)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  fecha_sourcing fecha_ultimo_contacto\n1          44729                 44739\n2          44729                 44739\n3          44729                 44739\n4          44729                 44739\n5          44729                 44739\n```\n:::\n:::\n\n\nEn la tabla anterior vemos que el valor que obtenemos en la primera columna es `44729`, el n√∫mero que representa a la fecha `17/6/22` como podemos apreciar en el archivo original:\n\n![](data/excel_vista.png)\n\nAhora veremos c√≥mo podemos resolver este problema.\n\n## Soluci√≥n\n\nPara empezar, seleccionemos algunas columnas nom√°s usando la funci√≥n `select()`. Vamos a seleccionar los campos de `fecha_sourcing` que representa cu√°ndo inici√≥ la b√∫squeda, `nombre`, `empresa`, y `fecha_ultimo_contacto` donde anotamos cu√°ndo fue la √∫ltima vez que nos pusimos en contacto con cada persona.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Seleccionar los campos con fechas, nombre y empres y sobreescribo el data frame\ndatos <- datos %>% \n  select(fecha_sourcing, nombre, empresa, fecha_ultimo_contacto)\n\n# Ver el nuevo dataframe\ndatos\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  fecha_sourcing   nombre empresa fecha_ultimo_contacto\n1          44729   Sergio    R4HR                 44739\n2          44729  Daniela    R4HR                 44739\n3          44729    Yanel    R4HR                 44739\n4          44729    Carla    R4HR                 44739\n5          44729 Santiago    R4HR                 44739\n```\n:::\n:::\n\n\nAhora nos quedamos con un data frame de 5 filas y 4 columnas.\n\nPara transformar el campo `fecha_sourcing` de un formato num√©rico a un formato de tipo fecha, vamos a usar la funci√≥n `as.Date()` de R base.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Transformar el campo fecha_sourcing a tipo fecha\ndatos %>% \n  mutate(fecha_sourcing = as.Date(fecha_sourcing,          # Sobrescribimos el campo fecha_sourcing\n                                  origin = \"1899-12-30\",   # Fecha de origen para el conteo\n                                  tz = \"UTC\"))             # Huso horario\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  fecha_sourcing   nombre empresa fecha_ultimo_contacto\n1     2022-06-17   Sergio    R4HR                 44739\n2     2022-06-17  Daniela    R4HR                 44739\n3     2022-06-17    Yanel    R4HR                 44739\n4     2022-06-17    Carla    R4HR                 44739\n5     2022-06-17 Santiago    R4HR                 44739\n```\n:::\n:::\n\n\nEl trabajo con fechas siempre fue complejo desde el punto de vista del an√°lisis de datos. Especialmente con los distintos formatos que se usan en el mundo, por ejemplo `dd/mm/aaaa` en Sudam√©rica, o `mm/dd/aaaa` en Estados Unidos por ejemplo. R, cuando un campo fecha carga correctamente, lo transforma a un formato ISO 8601 `aaaa-mm-dd`.\n\n![](data/perfect_date.jpg){width=\"323\"}\n\nEl primer n√∫mero que obtuvimos cuando cargamos la tabla en R (el `44729`) significa que desde el 30 de diciembre de 1899 hasta el 17 de Junio de 2022 pasaron 44.729 d√≠as. De ah√≠ el n√∫mero que obtuvimos en la carga.\n\nEl par√°metro `tz`, nos permite especificar el huso horario del registro. Para algunos casos puede ser relevante, pero para la mayor√≠a de los casos de uso que le dar√≠amos en RRHH, es un par√°metro que podemos incluir o no.\n\n### Cambiar varios campos a la vez\n\nCon la tabla que estamos usando de ejemplo, no hay mucho problema en repetir el paso ya que √∫nicamente tenemos dos campos de fechas. ¬øPero qu√© pasa si tenemos 6, 7, o m√°s campos de fechas en un archivo? Repetir estos pasos manualmente va a hacer confuso nuestro c√≥digo y m√°s complejo de mantener.\n\nVeamos una forma de cambiar todos los campos de fecha usando algunas funciones auxiliares del paquete `dplyr`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cambios los dos campos de fecha a la vez\ndatos %>% \n  mutate(across(starts_with(\"fecha\"),\n                ~as.Date(.x,\n                         tz = \"UTC\",\n                         origin = \"1899-12-30\")))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  fecha_sourcing   nombre empresa fecha_ultimo_contacto\n1     2022-06-17   Sergio    R4HR            2022-06-27\n2     2022-06-17  Daniela    R4HR            2022-06-27\n3     2022-06-17    Yanel    R4HR            2022-06-27\n4     2022-06-17    Carla    R4HR            2022-06-27\n5     2022-06-17 Santiago    R4HR            2022-06-27\n```\n:::\n:::\n\n\nEn este caso usamos la funci√≥n `across()` para indicarle a R que ejecute la funci√≥n (en este ejemplo, `as.Date()`) en todas las variables que cumplan con alg√∫n criterio. En este ejemplo, nos valemos de otra funci√≥n auxiliar, `starts_with()`, que como su nombre en ingl√©s lo indica, va a ejecutar la funci√≥n en todas las columnas que empiecen con el t√©rmino `\"fecha\"`.\n\nEste ejemplo funciona porque los campos que contienen una fecha comienzan con el nombre *fecha*. Por eso es importante al momento de dise√±ar una base de datos, un formulario, o cualquier registro que utilicemos para que haya una consistencia entre los nombres de los campos para facilitarnos posteriormente el proceso y an√°lisis de datos, independiemente del software que utilicemos.\n\nPresten atenci√≥n a que delante de la funci√≥n `as.Date()` usamos este s√≠mbolo (`~` ) llamado virgulilla (en Neuqu√©n, Argentina, le dr√≠amos √±uflo). Con ese s√≠mbolo le indicamos a R que esa va a ser la funci√≥n que vamos a replicar en todos los campos.\n\nEl argumento `.x`, representa a todas las columnas que hab√≠amos seleccionado con las funciones `across()` y `starts_with()`. Es decir que es la forma que tiene R de simplificar cu√°les son los campos que tiene que transformar sin que le tengamos que indicar uno por uno cuales son.\n\n# Todo lo anterior en un tweet\n\nEste post lo hice originalmente en 2022, y recuerdo que al d√≠a siguiente de haberlo publicado, me encontr√© con el paquete `anytime` desarrollado por [Dirk Eddelbuettel](https://dirk.eddelbuettel.com/), que resuelve muchos de estos inconvenientes en un tuit (es decir, con pocas l√≠neas de c√≥digo).\n\nCarguemos los datos nuevamente:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar los datos en R\ndatos <- read.xlsx(\"data/Postulantes.xlsx\") %>% \n  janitor::clean_names() # Usamos solo la funci√≥n clean_names() sin cargar todo el paquete janitor\n\n# Seleccionemos dos campos nada m√°s\ndatos2 <- datos %>% \n  select(apellido, fecha_ultimo_contacto)\n```\n:::\n\n\nAhora instalemos el paquete `anytime`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Instalar 'anytime'\ninstall.packages(\"anytime\")\n```\n:::\n\n\nEl pr√≥ximo paso es cargar el paquete.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Cargar anytime\nlibrary(anytime)\n```\n:::\n\n\nPara corregir la forma en que el campo fecha est√° cargado desde Excel s√≥lo tenemos que hacer lo siguiente:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sobreescribir el campo de fecha\ndatos2 <- datos2 %>% \n  mutate(fecha_ultimo_contacto = anydate(fecha_ultimo_contacto))\n\n# Ver los resultados\ndatos2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  apellido fecha_ultimo_contacto\n1   Garcia            2092-06-28\n2   Garcia            2092-06-28\n3 Paulette            2092-06-28\n4   Cirone            2092-06-28\n5  Lardone            2092-06-28\n```\n:::\n:::\n\n\nEn este ejemplo, el a√±o no es el correcto y si prestamos atenci√≥n en vez de 27 de Junio, nos arroja **28 de Junio**. Esto es un efecto de cu√°l es la fecha que se toma de origen: en los ejemplos anteriores ve√≠amos que defin√≠amos `1899-12-30`, en cambio el paquete `anytime` usa `1/1/1970`. Esto explica en parte los problemas que nos causa Excel con las fechas (y R tambi√©n, digamos todo).\n\nIncluso el origen del archivo puede ser un problema. Por ejemplo, si genero un archivo de Excel o un csv en Argentina, donde usamos el formato de fecha `dd/mm/yyyy` (d√≠a, mes, a√±o), y se lo mando a una persona en Estados Unidos donde usan el formato de fecha `mm/dd/yyyy` (mes, d√≠a, a√±o) puede generar que algo que funciona en un lado, no funcione en otro.\n\nPor eso si bien este ejemplo no es perfecto, quer√≠a compartirlo porque el c√≥digo es s√∫per simple, y adem√°s a Dirk, el creador del paquete, le encant√≥ este meme:\n\n![](/posts/cargar_fechas_desde_excel/data/anytime_meme.webp){width=\"502\"}\n\nAs√≠ que si bien trabajar con fechas y horas siempre es complejo, independientemente si est√°s trabajando con R, Python, Excel, o Power BI. Con este post quer√≠amos mostrar una forma de hacerlo. Tambi√©n existe el paquete `lubridate` que permite trabajar y hacer c√°lculos con fechas y del cual hicimos un tutorial que pod√©s ver en [YouTube](https://youtu.be/rU5153nki7c) y descargar el c√≥digo desde [GitHub](https://github.com/r4hr/club_de_r/blob/master/Sesion_27_Lubridate.R).\n\nSi bien, los paquetes como `lubridate` o `anytime` son m√°s intuitivos de usar, a veces por un tema de falta de mantenimiento, versiones diferentes, o performance, conviene usar las funciones de R base.\n\n# La comunidad de R4HR ü•ù\n\nR4HR, la comunidad que tambi√©n llamamos el Club de R para RRHH es una comunidad de aprendizaje de programaci√≥n en R destinada para todas las personas que trabajan o quieran trabajar en RRHH en todas partes del mundo. Pensamos esta comunidad inicialmente para la comunidad hispanoparlante para facilitar el aprendizaje y generar contenido que sea relevante para las personas que nos desarrollamos en estas funciones.\n\nPodes sumarte a nuestra comunidad en Slack, o bien seguirnos en redes sociales, acceder a todo nuestro contenido y participar en nuestras actividades gratuitas y abiertas. [Todo eso lo encontr√°s en este link](https://linktr.ee/r4hrclub) ü•ù.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}